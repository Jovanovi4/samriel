{% extends 'main/layout.html' %}

{% block title %}
{% if building %}
    Редактировать объект недвижимости
{% else %}
    Добавить объект недвижимости
{% endif %}
{% endblock %}

{% block content %}
<div class="main-content">
    <h1>{% if building %}Редактировать{% else %}Добавить{% endif %} объект недвижимости:</h1>
    <h1>{{ building.title }}</h1>
    <div class="form-container mt-3">
        <!-- Форма выбора типа недвижимости (только при добавлении нового объекта) -->
        {% if not building %}
        <form method="get" class="type-selection-form mb-3">
            {% csrf_token %}
            <label for="type">Тип недвижимости:</label>
            <select id="type" name="type" onchange="this.form.submit()">
                <option value="">Выберите тип</option>
                <option value="1" {% if request.GET.type == "1" %}selected{% endif %}>Новая недвижимость</option>
                <option value="2" {% if request.GET.type == "2" %}selected{% endif %}>Вторичное жильё</option>
            </select>
        </form>
        {% endif %}

        {% if request.GET.type or building %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="type" value="{{ type }}">

            <!-- Навигация по вкладкам -->
            <ul class="nav nav-tabs" id="propertyTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="general-tab" data-bs-toggle="tab" href="#general" role="tab" aria-controls="general" aria-selected="true">Общие данные</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="images-tab" data-bs-toggle="tab" href="#images" role="tab" aria-controls="images" aria-selected="false">Изображение</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="seo-tab" data-bs-toggle="tab" href="#seo" role="tab" aria-controls="seo" aria-selected="false">SEO</a>
                </li>
            </ul>

            <!-- Контент вкладок -->
            <div class="tab-content mt-3" id="propertyTabContent">
                <!-- Вкладка "Общие данные" -->
                <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                    <!-- Секция 1 -->
                    <div class="form-section">
                        <h3>Основные данные</h3>
                        <div class="form-group">
                            {{ form.title.label_tag }} {{ form.title }}
                        </div>
                        <div class="form-group">
                            {{ form.top_description.label_tag }} {{ form.top_description }}
                        </div>
                        <div class="form-group">
                            {{ form.down_description.label_tag }} {{ form.down_description }}
                        </div>

                        <!-- Поля для вторичного жилья -->
                        {% if type == '2' %}
                        <div class="form-group form-inline">
                            <div class="inline-field">
                                {{ form.square.label_tag }} {{ form.square }}
                            </div>
                            <div class="inline-field">
                                {{ form.price.label_tag }} {{ form.price }}
                            </div>
                            <div class="inline-field">
                                {{ form.floor.label_tag }} {{ form.floor }}
                            </div>
                            <div class="inline-field">
                                {{ form.all_floor.label_tag }} {{ form.all_floor }}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Поля для нового жилья -->
                        {% if type == '1' %}
                        <div class="form-group">
                            {{ form.deadline.label_tag }} {{ form.deadline }}
                        </div>
                        <div class="form-group">
                            {{ form.jarlyk.label_tag }} {{ form.jarlyk }}
                        </div>
                        {% endif %}
                        <div class="form-group">
                            {{ form.about_before_slide.label_tag }} {{ form.about_before_slide }}
                        </div>
                        <div class="form-group">
                            {{ form.about_after_slide.label_tag }} {{ form.about_after_slide }}
                        </div>
                        <div class="form-group">
                            {{ form.category.label_tag }} {{ form.category }}
                        </div>

                        {% if type == '1' %}
                        <div class="form-section">
                            <h3>Видео</h3>
                            <div class="form-group">
                                {{ form.video_name.label_tag }} {{ form.video_name }}
                            </div>
                            <div class="form-group">
                                {{ form.video.label_tag }} {{ form.video }}
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Местоположение -->
                    <div class="form-section">
                        <h3>Местоположение</h3>
                        <div class="form-group">
                            {{ form.location.label_tag }} {{ form.location }}
                        </div>
                        <div class="form-group">
                            {{ form.adres.label_tag }} {{ form.adres }}
                        </div>
                    </div>

                    <!-- Характеристики -->
                    <div class="form-section">
                        <h3>Характеристики</h3>
                        <div class="form-group">
                            {{ form.characteristic.label_tag }} {{ form.characteristic }}
                        </div>
                        <div class="form-group">
                            {{ form.description.label_tag }} {{ form.description }}
                        </div>
                    </div>

                    <!-- Преимущества -->
                    <div class="form-section">
                        <h3>Преимущества</h3>
                        <div class="form-group">
                            {{ form.advantages.label_tag }} {{ form.advantages }}
                        </div>
                        <div class="form-group">
                            {{ form.deteil_description.label_tag }} {{ form.deteil_description }}
                        </div>
                    </div>
                </div>

                <!-- Вкладка "Изображение" -->
                <div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab">
                    <div class="form-section">
                        <h3>Изображение</h3>
                        <div class="form-group">
                            {{ form.image }}
                        </div>
                    </div>
                </div>

                <!-- Вкладка "SEO" -->
                <div class="tab-pane fade" id="seo" role="tabpanel" aria-labelledby="seo-tab">
                    <div class="form-section">
                        <h3>SEO данные</h3>
                        {{ seo_form.as_p }}
                    </div>
                </div>
            </div>

            <!-- Кнопка сохранения -->
            <button type="submit" class="btn btn-primary mt-3">Сохранить</button>
        </form>
        {% endif %}
    </div>
</div>
{% endblock %}
